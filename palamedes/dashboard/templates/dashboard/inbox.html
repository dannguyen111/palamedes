{% extends "homepage/base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <h2>Point Request Inbox</h2>
    </div>
</div>

{% if my_action_items or exec_queue %}
<div class="card shadow mb-5">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0">‚ö†Ô∏è Action Required</h5>
    </div>
    <div class="list-group list-group-flush">

        {% for point in my_action_items %}
        {% include "dashboard/partials/point_row.html" with point=point queue_type="direct" %}
        {% endfor %}

        {% for point in exec_queue %}
        {% include "dashboard/partials/point_row.html" with point=point queue_type="exec" %}
        {% endfor %}
    </div>
</div>
{% else %}
<div class="alert alert-success text-center">
    All caught up! No pending requests.
</div>
{% endif %}

{% if history %}
<div class="card shadow mt-4">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">üìú My History Log</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="thead-light">
                <tr>
                    <th>Recipient</th>
                    <th>Approved By</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date Requested</th>
                    <th>Last Updated</th>
                </tr>
            </thead>
            <tbody>
                {% for point in history %}
                <tr>
                    <td class="font-weight-bold">
                        {% if point.user == user %}
                        <span class="text-primary">Me</span>
                        {% else %}
                        {{ point.user.first_name }} {{ point.user.last_name }}
                        {% endif %}
                    </td>

                    <td>
                        {% if point.assigned_approver %}
                        {{ point.assigned_approver.first_name }} {{ point.assigned_approver.last_name }}
                        {% elif point.status == 'APPROVED' and point.submitted_by != point.user %}
                        {{ point.submitted_by.first_name }} (Direct)
                        {% else %}
                        <span class="text-muted font-italic">Pending Exec</span>
                        {% endif %}
                    </td>

                    <td>{{ point.amount }}</td>

                    <td>
                        {% if point.status == 'APPROVED' %}
                        <span class="badge badge-success">Approved</span>
                        {% elif point.status == 'REJECTED' %}
                        <span class="badge badge-danger">Rejected</span>
                        {% elif point.status == 'PENDING' %}
                        <span class="badge badge-secondary">Pending</span>
                        {% elif point.status == 'COUNTERED' %}
                        <span class="badge badge-warning">Countered</span>
                        {% endif %}
                    </td>

                    <td>{{ point.date_submitted|date:"M d" }}</td>
                    <td>{{ point.updated_at|date:"M d, H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}